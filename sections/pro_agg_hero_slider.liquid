{%- liquid
  assign slider_id = 'agg-hero-' | append: section.id
  assign height_mode = section.settings.height_mode
-%}
<link rel="stylesheet" href="{{ 'pro_agg_hero_slider.css' | asset_url }}" media="all">

<section
  id="{{ slider_id }}"
  class="section agg-hero color-{{ section.settings.color_scheme }} gradient height--{{ height_mode }}"
  role="region"
  aria-roledescription="carousel"
  aria-label="{{ section.settings.accessibility_label | default: 'Featured hero carousel' | escape }}"
  style="
    --h-fixed-desktop: {{ section.settings.height_fixed_desktop | default: 600 }}px;
    --h-fixed-mobile: {{ section.settings.height_fixed_mobile | default: 420 }}px;
    --aspect-ratio: {{ section.settings.aspect_ratio | default: '16-9' | replace: '-', ' / ' }};
  "
  data-autoplay="{{ section.settings.autoplay }}"
  data-interval="{{ section.settings.autoplay_interval | times: 1000 }}"
  data-loop="{{ section.settings.loop }}"
  data-init="false"
  tabindex="-1"
>
  <p class="visually-hidden" id="{{ slider_id }}-status" aria-live="polite"></p>

  <div class="agg-hero__viewport">
    <div class="agg-hero__track" id="{{ slider_id }}-track" style="--slide-count: {{ section.blocks.size }};">
      {%- for block in section.blocks -%}
      {%- assign b = block.settings -%}
      <div
        class="agg-slide"
        id="{{ slider_id }}-s{{ forloop.index }}"
        role="group"
        aria-roledescription="slide"
        aria-label="{{ forloop.index }} of {{ section.blocks.size }}"
        aria-hidden="{% if forloop.first %}false{% else %}true{% endif %}"
        {{ block.shopify_attributes }}
      >
        <div class="agg-slide__media">
          {%- if b.image != blank -%}
            <picture>
              {%- if b.image_mobile != blank -%}
                <source media="(max-width: 749px)"
                  srcset="
                    {{ b.image_mobile | image_url: width: 375 }} 375w,
                    {{ b.image_mobile | image_url: width: 550 }} 550w,
                    {{ b.image_mobile | image_url: width: 750 }} 750w,
                    {{ b.image_mobile | image_url: width: 1100 }} 1100w"
                  sizes="100vw">
              {%- endif -%}
              <img
                class="agg-slide__img"
                src="{{ b.image | image_url: width: 1500 }}"
                srcset="
                  {{ b.image | image_url: width: 750 }} 750w,
                  {{ b.image | image_url: width: 1100 }} 1100w,
                  {{ b.image | image_url: width: 1500 }} 1500w,
                  {{ b.image | image_url: width: 2000 }} 2000w,
                  {{ b.image | image_url: width: 3000 }} 3000w"
                sizes="100vw"
                alt="{{ b.image_alt | default: 'Hero image' | escape }}"
                loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                decoding="async"
                fetchpriority="{% if forloop.first %}high{% else %}auto{% endif %}"
                width="{{ b.image.width }}"
                height="{{ b.image.height }}"
                style="object-position: {{ b.image.presentation.focal_point | default: 'center' }};"
              >
            </picture>
          {%- else -%}
            <div class="agg-slide__placeholder" role="img" aria-label="Placeholder"></div>
          {%- endif -%}

          <span
            class="agg-slide__overlay"
            aria-hidden="true"
            style="
              --overlay: {{ b.overlay_color | default: 'rgba(0,0,0,0.35)' }};
              --overlay-opacity: {{ b.overlay_opacity | default: 0.35 }};
              --blend: {{ b.overlay_blend | default: 'normal' }};
            ">
          </span>
        </div>

        <div class="agg-slide__content">
          {%- if b.heading != blank -%}
            <{{ b.heading_tag | default: 'h2' }}
              class="agg-heading pos-desktop-{{ b.heading_position_desktop | default: 'cc' }} pos-mobile-{{ b.heading_position_mobile | default: 'tc' }}"
              style="
                --offset-x: {{ b.heading_offset_x | default: 0 }}rem;
                --offset-y: {{ b.heading_offset_y | default: 0 }}rem;
                max-width: {{ b.content_max_width | default: 40 }}rem;">
              {{ b.heading }}
            </{{ b.heading_tag | default: 'h2' }}>
          {%- endif -%}

          {%- if b.subheading != blank -%}
            <p class="agg-subheading pos-desktop-{{ b.subheading_position_desktop | default: 'cc' }} pos-mobile-{{ b.subheading_position_mobile | default: 'tc' }}"
               style="
                 --offset-x: {{ b.subheading_offset_x | default: 0 }}rem;
                 --offset-y: {{ b.subheading_offset_y | default: 0 }}rem;
                 max-width: {{ b.content_max_width | default: 40 }}rem;">
              {{ b.subheading }}
            </p>
          {%- endif -%}

          {%- if b.body != blank -%}
            <div class="agg-body rte pos-desktop-{{ b.body_position_desktop | default: 'cc' }} pos-mobile-{{ b.body_position_mobile | default: 'tc' }}"
                 style="
                   --offset-x: {{ b.body_offset_x | default: 0 }}rem;
                   --offset-y: {{ b.body_offset_y | default: 0 }}rem;
                   max-width: {{ b.content_max_width | default: 40 }}rem;">
              {{ b.body }}
            </div>
          {%- endif -%}

          {%- if b.button_primary_label != blank or b.button_secondary_label != blank -%}
            <div class="agg-ctas pos-desktop-{{ b.buttons_position_desktop | default: 'cc' }} pos-mobile-{{ b.buttons_position_mobile | default: 'bc' }}"
                 style="--offset-x: {{ b.buttons_offset_x | default: 0 }}rem; --offset-y: {{ b.buttons_offset_y | default: 0 }}rem;">
              {%- if b.button_primary_label != blank and b.button_primary_link != blank -%}
                <a href="{{ b.button_primary_link }}"
                   class="agg-btn agg-btn--{{ b.button_primary_style | default: 'primary' }}"
                   {% if b.button_primary_newtab %}target="_blank" rel="noopener"{% endif %}>
                   {{ b.button_primary_label }}
                </a>
              {%- endif -%}
              {%- if b.button_secondary_label != blank and b.button_secondary_link != blank -%}
                <a href="{{ b.button_secondary_link }}"
                   class="agg-btn agg-btn--{{ b.button_secondary_style | default: 'outline' }}"
                   {% if b.button_secondary_newtab %}target="_blank" rel="noopener"{% endif %}>
                   {{ b.button_secondary_label }}
                </a>
              {%- endif -%}
            </div>
          {%- endif -%}
        </div>
      </div>
      {%- endfor -%}
    </div>
  </div>

  <div class="agg-hero__controls">
    <button class="agg-ctrl agg-ctrl--prev" type="button"
      aria-controls="{{ slider_id }}-track"
      aria-label="{{ 'sections.slideshow.previous' | t | default: 'Previous slide' }}">
      <svg aria-hidden="true" width="20" height="20" viewBox="0 0 20 20" focusable="false"><path d="M12.7 15.3a1 1 0 0 1-1.4 0l-4-4a1 1 0 0 1 0-1.4l4-4a1 1 0 1 1 1.4 1.4L9.41 10l3.3 3.3a1 1 0 0 1 0 1.4z" /></svg>
    </button>

    <button class="agg-ctrl agg-ctrl--next" type="button"
      aria-controls="{{ slider_id }}-track"
      aria-label="{{ 'sections.slideshow.next' | t | default: 'Next slide' }}">
      <svg aria-hidden="true" width="20" height="20" viewBox="0 0 20 20" focusable="false"><path d="M7.3 4.7a1 1 0 0 1 1.4 0l4 4a1 1 0 0 1 0 1.4l-4 4a1 1 0 1 1-1.4-1.4L10.59 10 7.3 6.7a1 1 0 0 1 0-1.4z" /></svg>
    </button>

    <button class="agg-ctrl agg-ctrl--pause" type="button"
      aria-pressed="false"
      aria-label="{{ 'sections.slideshow.pause' | t | default: 'Pause autoplay' }}">
      <span class="agg-ctrl__label agg-ctrl__label--play">{{ 'sections.slideshow.play' | t | default: 'Play' }}</span>
      <span class="agg-ctrl__label agg-ctrl__label--pause">{{ 'sections.slideshow.pause' | t | default: 'Pause' }}</span>
    </button>
  </div>

  {% if section.settings.show_dots %}
    <div class="agg-hero__dots" role="tablist" aria-label="Slide pagination">
      {%- for block in section.blocks -%}
        <button class="agg-dot"
          role="tab"
          aria-controls="{{ slider_id }}-s{{ forloop.index }}"
          aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
          aria-label="Go to slide {{ forloop.index }}"></button>
      {%- endfor -%}
    </div>
  {% endif %}
</section>

<script src="{{ 'pro_agg_hero_slider.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "AGG â€¢ Hero slider",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme" },

    { "type": "text", "id": "accessibility_label", "label": "Aria label", "default": "Featured hero carousel" },

    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": true },
    { "type": "range", "id": "autoplay_interval", "label": "Autoplay interval (sec)", "min": 3, "max": 10, "step": 1, "unit": "s", "default": 5 },
    { "type": "checkbox", "id": "loop", "label": "Loop", "default": true },

    { "type": "select", "id": "height_mode", "label": "Height mode", "default": "viewport", "options": [
      { "value": "viewport", "label": "Full viewport" },
      { "value": "fixed", "label": "Fixed height" },
      { "value": "aspect", "label": "Aspect ratio" }
    ]},
    { "type": "range", "id": "height_fixed_desktop", "label": "Fixed height desktop (px)", "min": 300, "max": 900, "step": 10, "default": 600 },
    { "type": "range", "id": "height_fixed_mobile", "label": "Fixed height mobile (px)", "min": 200, "max": 700, "step": 10, "default": 420 },
    { "type": "select", "id": "aspect_ratio", "label": "Aspect", "default": "16-9", "options": [
      { "value": "21-9", "label": "21:9" },
      { "value": "16-9", "label": "16:9" },
      { "value": "4-3", "label": "4:3" },
      { "value": "3-2", "label": "3:2" }
    ]},
    { "type": "checkbox", "id": "show_dots", "label": "Show pagination dots", "default": true }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "image_picker", "id": "image_mobile", "label": "Mobile image (optional)" },
        { "type": "text", "id": "image_alt", "label": "Image alt text", "default": "Hero image" },

        { "type": "color_background", "id": "overlay_color", "label": "Overlay color", "default": "rgba(0,0,0,0.35)" },
        { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 1, "step": 0.05, "default": 0.35 },
        { "type": "select", "id": "overlay_blend", "label": "Overlay blend mode", "default": "normal", "options": [
          { "value": "normal", "label": "Normal" },
          { "value": "multiply", "label": "Multiply" },
          { "value": "overlay", "label": "Overlay" },
          { "value": "screen", "label": "Screen" },
          { "value": "soft-light", "label": "Soft light" }
        ]},

        { "type": "select", "id": "heading_tag", "label": "Heading tag", "default": "h2", "options": [
          { "value": "h1", "label": "H1" },
          { "value": "h2", "label": "H2" },
          { "value": "h3", "label": "H3" }
        ]},
        { "type": "text", "id": "heading", "label": "Heading", "default": "Tow more. Go farther." },
        { "type": "text", "id": "subheading", "label": "Subheading", "default": "Hitches, racks, cargo." },
        { "type": "richtext", "id": "body", "label": "Body", "default": "<p>Storage made simple. Shop towing, cargo, and trailâ€‘ready essentials.</p>" },
        { "type": "range", "id": "content_max_width", "label": "Max content width (rem)", "min": 20, "max": 60, "step": 1, "default": 40 },

        { "type": "select", "id": "heading_position_desktop", "label": "Heading position (desktop)", "default": "cc", "options": [
          {"value":"tl","label":"Topâ€‘Left"},{"value":"tc","label":"Topâ€‘Center"},{"value":"tr","label":"Topâ€‘Right"},
          {"value":"cl","label":"Centerâ€‘Left"},{"value":"cc","label":"Center"},{"value":"cr","label":"Centerâ€‘Right"},
          {"value":"bl","label":"Bottomâ€‘Left"},{"value":"bc","label":"Bottomâ€‘Center"},{"value":"br","label":"Bottomâ€‘Right"}
        ]},
        { "type": "select", "id": "heading_position_mobile", "label": "Heading position (mobile)", "default": "tc", "options": [
          {"value":"tl","label":"Topâ€‘Left"},{"value":"tc","label":"Topâ€‘Center"},{"value":"tr","label":"Topâ€‘Right"},
          {"value":"cl","label":"Centerâ€‘Left"},{"value":"cc","label":"Center"},{"value":"cr","label":"Centerâ€‘Right"},
          {"value":"bl","label":"Bottomâ€‘Left"},{"value":"bc","label":"Bottomâ€‘Center"},{"value":"br","label":"Bottomâ€‘Right"}
        ]},
        { "type": "range", "id": "heading_offset_x", "label": "Heading offset X (rem)", "min": -10, "max": 10, "step": 0.5, "default": 0 },
        { "type": "range", "id": "heading_offset_y", "label": "Heading offset Y (rem)", "min": -10, "max": 10, "step": 0.5, "default": 0 },

        { "type": "select", "id": "subheading_position_desktop", "label": "Subheading position (desktop)", "default": "cc", "options": [
          {"value":"tl","label":"Topâ€‘Left"},{"value":"tc","label":"Topâ€‘Center"},{"value":"tr","label":"Topâ€‘Right"},
          {"value":"cl","label":"Centerâ€‘Left"},{"value":"cc","label":"Center"},{"value":"cr","label":"Centerâ€‘Right"},
          {"value":"bl","label":"Bottomâ€‘Left"},{"value":"bc","label":"Bottomâ€‘Center"},{"value":"br","label":"Bottomâ€‘Right"}
        ]},
        { "type": "select", "id": "subheading_position_mobile", "label": "Subheading position (mobile)", "default": "tc", "options": [
          {"value":"tl","label":"Topâ€‘Left"},{"value":"tc","label":"Topâ€‘Center"},{"value":"tr","label":"Topâ€‘Right"},
          {"value":"cl","label":"Centerâ€‘Left"},{"value":"cc","label":"Center"},{"value":"cr","label":"Centerâ€‘Right"},
          {"value":"bl","label":"Bottomâ€‘Left"},{"value":"bc","label":"Bottomâ€‘Center"},{"value":"br","label":"Bottomâ€‘Right"}
        ]},
        { "type": "range", "id": "subheading_offset_x", "label": "Subheading offset X (rem)", "min": -10, "max": 10, "step": 0.5, "default": 0 },
        { "type": "range", "id": "subheading_offset_y", "label": "Subheading offset Y (rem)", "min": -10, "max": 10, "step": 0.5, "default": 0 },

        { "type": "select", "id": "body_position_desktop", "label": "Body position (desktop)", "default": "cc", "options": [
          {"value":"tl","label":"Topâ€‘Left"},{"value":"tc","label":"Topâ€‘Center"},{"value":"tr","label":"Topâ€‘Right"},
          {"value":"cl","label":"Centerâ€‘Left"},{"value":"cc","label":"Center"},{"value":"cr","label":"Centerâ€‘Right"},
          {"value":"bl","label":"Bottomâ€‘Left"},{"value":"bc","label":"Bottomâ€‘Center"},{"value":"br","label":"Bottomâ€‘Right"}
        ]},
        { "type": "select", "id": "body_position_mobile", "label": "Body position (mobile)", "default": "tc", "options": [
          {"value":"tl","label":"Topâ€‘Left"},{"value":"tc","label":"Topâ€‘Center"},{"value":"tr","label":"Topâ€‘Right"},
          {"value":"cl","label":"Centerâ€‘Left"},{"value":"cc","label":"Center"},{"value":"cr","label":"Centerâ€‘Right"},
          {"value":"bl","label":"Bottomâ€‘Left"},{"value":"bc","label":"Bottomâ€‘Center"},{"value":"br","label":"Bottomâ€‘Right"}
        ]},
        { "type": "range", "id": "body_offset_x", "label": "Body offset X (rem)", "min": -10, "max": 10, "step": 0.5, "default": 0 },
        { "type": "range", "id": "body_offset_y", "label": "Body offset Y (rem)", "min": -10, "max": 10, "step": 0.5, "default": 0 },

        { "type": "select", "id": "buttons_position_desktop", "label": "Buttons position (desktop)", "default": "cc", "options": [
          {"value":"tl","label":"Topâ€‘Left"},{"value":"tc","label":"Topâ€‘Center"},{"value":"tr","label":"Topâ€‘Right"},
          {"value":"cl","label":"Centerâ€‘Left"},{"value":"cc","label":"Center"},{"value":"cr","label":"Centerâ€‘Right"},
          {"value":"bl","label":"Bottomâ€‘Left"},{"value":"bc","label":"Bottomâ€‘Center"},{"value":"br","label":"Bottomâ€‘Right"}
        ]},
        { "type": "select", "id": "buttons_position_mobile", "label": "Buttons position (mobile)", "default": "bc", "options": [
          {"value":"tl","label":"Topâ€‘Left"},{"value":"tc","label":"Topâ€‘Center"},{"value":"tr","label":"Topâ€‘Right"},
          {"value":"cl","label":"Centerâ€‘Left"},{"value":"cc","label":"Center"},{"value":"cr","label":"Centerâ€‘Right"},
          {"value":"bl","label":"Bottomâ€‘Left"},{"value":"bc","label":"Bottomâ€‘Center"},{"value":"br","label":"Bottomâ€‘Right"}
        ]},
        { "type": "range", "id": "buttons_offset_x", "label": "Buttons offset X (rem)", "min": -10, "max": 10, "step": 0.5, "default": 0 },
        { "type": "range", "id": "buttons_offset_y", "label": "Buttons offset Y (rem)", "min": -10, "max": 10, "step": 0.5, "default": 0 },

        { "type": "checkbox", "id": "shimmer_text", "label": "Shimmer heading", "default": false },

        { "type": "text", "id": "button_primary_label", "label": "Primary button label", "default": "Shop now" },
        { "type": "url", "id": "button_primary_link", "label": "Primary button link" },
        { "type": "checkbox", "id": "button_primary_newtab", "label": "Open primary in new tab", "default": false },
        { "type": "select", "id": "button_primary_style", "label": "Primary button style", "default": "primary", "options": [
          { "value": "primary", "label": "Primary" },
          { "value": "secondary", "label": "Secondary" },
          { "value": "outline", "label": "Outline" },
          { "value": "ghost", "label": "Ghost" }
        ]},

        { "type": "text", "id": "button_secondary_label", "label": "Secondary button label", "default": "Learn more" },
        { "type": "url", "id": "button_secondary_link", "label": "Secondary button link" },
        { "type": "checkbox", "id": "button_secondary_newtab", "label": "Open secondary in new tab", "default": false },
        { "type": "select", "id": "button_secondary_style", "label": "Secondary button style", "default": "outline", "options": [
          { "value": "primary", "label": "Primary" },
          { "value": "secondary", "label": "Secondary" },
          { "value": "outline", "label": "Outline" },
          { "value": "ghost", "label": "Ghost" }
        ]}
      ]
    }
  ],
  "presets": [
    {
      "name": "AGG â€¢ Hero slider",
      "blocks": [
        { "type": "slide", "settings": { "heading": "Adventure starts here", "subheading": "Gear up for every road.", "button_primary_label": "Shop towing", "button_secondary_label": "Explore racks" } },
        { "type": "slide", "settings": { "heading": "Roadâ€‘trip ready", "subheading": "Storage made simple.", "button_primary_label": "Shop cargo", "button_secondary_label": "See bundles" } }
      ]
    }
  ]
}
{% endschema %}
