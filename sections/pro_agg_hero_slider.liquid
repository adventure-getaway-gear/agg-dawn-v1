{% comment %}
  Section: pro_agg_hero_slider
  Brand: Adventure Getaway Gear
  Purpose: Accessible, mobile-first hero slider with autoplay, arrows, dots, and pause control.
  Notes: No external libraries. Scroll-snap + lightweight JS for robust performance.
{% endcomment %}

{{ 'pro_agg_hero_slider.css' | asset_url | stylesheet_tag }}
<script src="{{ 'pro_agg_hero_slider.js' | asset_url }}" defer="defer"></script>

{% liquid
  assign autoplay = section.settings.autoplay
  assign interval_s = section.settings.autoplay_speed
  assign show_arrows = section.settings.show_arrows
  assign show_dots = section.settings.show_dots
  assign show_pause = section.settings.show_pause
%}

<section
  id="agg-hero-{{ section.id }}"
  class="agg-hero color-{{ section.settings.color_scheme }}{% if section.settings.full_width %} agg-hero--full{% endif %}"
  data-section-id="{{ section.id }}"
  data-autoplay="{{ autoplay }}"
  data-interval="{{ interval_s }}"
  style="
    --agg-hero-h-desktop: {{ section.settings.height_desktop }}vh;
    --agg-hero-h-mobile: {{ section.settings.height_mobile }}vh;
    --agg-hero-pad-top: {{ section.settings.padding_top }}px;
    --agg-hero-pad-bottom: {{ section.settings.padding_bottom }}px;
    --agg-content-max: {{ section.settings.content_max_width }}px;
  "
>
  <div class="agg-hero__inner">
    <div
      class="agg-hero__slider"
      role="region"
      aria-roledescription="carousel"
      aria-label="{{ section.settings.accessible_label | default: 'Hero slider' }}"
      aria-live="polite"
      tabindex="0"
      data-slides
    >
      {% for block in section.blocks %}
        {% assign img = block.settings.image %}
        {% assign img_m = block.settings.mobile_image %}

        <div
          class="agg-hero__slide"
          id="agg-slide-{{ section.id }}-{{ forloop.index }}"
          role="group"
          aria-roledescription="slide"
          aria-label="{{ forloop.index }} of {{ section.blocks.size }}"
          {{ block.shopify_attributes }}
        >
          <div class="agg-hero__media">
            <picture>
              {% if img_m != blank %}
                <source media="(max-width: 749px)"
                        srcset="{{ img_m | image_url: width: 800 }} 800w, {{ img_m | image_url: width: 1200 }} 1200w"
                        sizes="100vw">
              {% endif %}

              {% if img != blank %}
                <source media="(min-width: 750px)"
                        srcset="{{ img | image_url: width: 1500 }} 1500w, {{ img | image_url: width: 2400 }} 2400w, {{ img | image_url: width: 3000 }} 3000w"
                        sizes="100vw">
                <img class="agg-hero__img"
                     src="{{ img | image_url: width: 1500 }}"
                     alt="{{ block.settings.alt | escape | default: block.settings.heading | escape }}"
                     loading="lazy"
                     width="{{ img.width }}"
                     height="{{ img.height }}">
              {% else %}
                {{ 'lifestyle-1' | placeholder_svg_tag: 'agg-hero__placeholder' }}
              {% endif %}
            </picture>
          </div>

          <div
            class="agg-hero__overlay"
            style="background-color: {{ block.settings.overlay_color }}; opacity: {{ block.settings.overlay_opacity | divided_by: 100.0 }};"
            aria-hidden="true"
          ></div>

          <div class="agg-hero__content agg-hero__content--{{ section.settings.text_align }} agg-hero__content-v-{{ section.settings.text_valign }}">
            <div class="agg-hero__box">
              {% if block.settings.subheading != blank %}
                <p class="agg-hero__eyebrow">{{ block.settings.subheading }}</p>
              {% endif %}
              {% if block.settings.heading != blank %}
                <h2 class="agg-hero__heading">{{ block.settings.heading }}</h2>
              {% endif %}
              {% if block.settings.text != blank %}
                <div class="agg-hero__text">{{ block.settings.text }}</div>
              {% endif %}
              {% if block.settings.button_label != blank and block.settings.button_link != blank %}
                <a class="button{% if block.settings.button_style == 'secondary' %} button--secondary{% endif %}"
                   href="{{ block.settings.button_link }}">
                  {{ block.settings.button_label }}
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if show_arrows %}
      <div class="agg-hero__controls" aria-hidden="false">
        <button class="agg-hero__prev" type="button" aria-label="Previous slide"><span aria-hidden="true">‹</span></button>
        <button class="agg-hero__next" type="button" aria-label="Next slide"><span aria-hidden="true">›</span></button>
      </div>
    {% endif %}

    {% if show_dots %}
      <div class="agg-hero__dots" role="tablist" aria-label="Slide navigation">
        {% for block in section.blocks %}
          <button
            class="agg-hero__dot"
            role="tab"
            aria-controls="agg-slide-{{ section.id }}-{{ forloop.index }}"
            aria-label="Go to slide {{ forloop.index }}"
            data-index="{{ forloop.index0 }}"
          ></button>
        {% endfor %}
      </div>
    {% endif %}

    {% if show_pause %}
      <button class="agg-hero__pause" type="button" aria-pressed="false" aria-label="Pause autoplay" hidden>Pause</button>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "AGG Hero Slider",
  "class": "section-pro-agg-hero",
  "settings": [
    { "type": "checkbox", "id": "full_width", "label": "Full width", "default": true },
    { "type": "select", "id": "color_scheme", "label": "Color scheme", "options": [
      { "value": "background-1", "label": "Background 1" },
      { "value": "background-2", "label": "Background 2" },
      { "value": "inverse", "label": "Inverse" }
    ], "default": "background-1" },

    { "type": "range", "id": "height_desktop", "min": 40, "max": 90, "step": 1, "unit": "vh", "label": "Height (desktop)", "default": 70 },
    { "type": "range", "id": "height_mobile", "min": 40, "max": 90, "step": 1, "unit": "vh", "label": "Height (mobile)", "default": 60 },

    { "type": "range", "id": "content_max_width", "min": 320, "max": 1000, "step": 10, "unit": "px", "label": "Content max width", "default": 720 },

    { "type": "select", "id": "text_align", "label": "Text align", "options": [
      { "value": "left", "label": "Left" },
      { "value": "center", "label": "Center" },
      { "value": "right", "label": "Right" }
    ], "default": "left" },

    { "type": "select", "id": "text_valign", "label": "Vertical align", "options": [
      { "value": "top", "label": "Top" },
      { "value": "middle", "label": "Middle" },
      { "value": "bottom", "label": "Bottom" }
    ], "default": "middle" },

    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": true },
    { "type": "range", "id": "autoplay_speed", "min": 3, "max": 10, "step": 1, "unit": "s", "label": "Autoplay speed", "default": 5 },

    { "type": "checkbox", "id": "show_arrows", "label": "Show arrows", "default": true },
    { "type": "checkbox", "id": "show_dots", "label": "Show dots", "default": true },
    { "type": "checkbox", "id": "show_pause", "label": "Show play/pause", "default": true },

    { "type": "range", "id": "padding_top", "min": 0, "max": 80, "step": 4, "unit": "px", "label": "Padding top", "default": 0 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 80, "step": 4, "unit": "px", "label": "Padding bottom", "default": 0 },

    { "type": "text", "id": "accessible_label", "label": "Accessible label", "default": "Homepage hero slider" }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "limit": 8,
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Desktop image" },
        { "type": "image_picker", "id": "mobile_image", "label": "Mobile image (optional)" },

        { "type": "text", "id": "subheading", "label": "Eyebrow" },
        { "type": "text", "id": "heading", "label": "Heading" },
        { "type": "richtext", "id": "text", "label": "Text" },

        { "type": "text", "id": "button_label", "label": "Button label" },
        { "type": "url", "id": "button_link", "label": "Button link" },
        { "type": "select", "id": "button_style", "label": "Button style", "default": "primary",
          "options": [
            { "value": "primary", "label": "Primary" },
            { "value": "secondary", "label": "Secondary" }
          ]
        },

        { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
        { "type": "range", "id": "overlay_opacity", "min": 0, "max": 90, "step": 5, "unit": "%", "label": "Overlay opacity", "default": 30 }
      ]
    }
  ],
  "presets": [
    {
      "name": "AGG Hero Slider",
      "blocks": [
        { "type": "slide" },
        { "type": "slide" },
        { "type": "slide" }
      ]
    }
  ]
}
{% endschema %}

