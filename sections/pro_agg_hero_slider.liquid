{% comment %}
  Section: pro_agg_hero_slider
  Theme: Adventure Getaway Gear (AGG)
  Purpose: Accessible, performant, customizable hero carousel with 9-point positioning, shimmer text, overlay blend modes, swipe/keyboard/autoplay controls.
  Notes:
  - Prefix: pro_agg_
  - A11y: WCAG AA, ARIA carousel pattern, focus-visible, aria-live slide announcements, pause autoplay control, reduced motion support
  - Performance: responsive images (srcset/sizes), CLS-safe aspect-ratio, lazy loading, GPU-friendly transforms
  - Intl: all labels translatable via schema
{% endcomment %}

{{ 'pro_agg_hero_slider.css' | asset_url | stylesheet_tag }}
<script src="{{ 'pro_agg_hero_slider.js' | asset_url }}" defer="defer"></script>

{%- liquid
  assign section_id = 'pro_agg_hero_slider-' | append: section.id
  assign show_arrows = section.settings.show_arrows
  assign show_dots = section.settings.show_dots
  assign autoplay = section.settings.autoplay
  assign autoplay_interval = section.settings.autoplay_interval | times: 1000
  assign loop_slides = section.settings.loop_slides
  assign swipe = section.settings.enable_swipe
  assign keyboard = section.settings.enable_keyboard
  assign shimmer_global = section.settings.enable_shimmer
  assign overlay_color = section.settings.overlay_color
  assign overlay_opacity = section.settings.overlay_opacity | divided_by: 100.0
  assign overlay_blend = section.settings.overlay_blend
  assign container_max_width = section.settings.container_max_width
  assign height_mode = section.settings.height_mode
  assign fixed_height = section.settings.fixed_height
  assign aspect_ratio = section.settings.aspect_ratio
  assign reduce_motion_policy = section.settings.reduce_motion_policy
  assign content_max_width = section.settings.content_max_width
-%}

<section
  id="{{ section_id }}"
  class="pro_agg_hero-slider"
  role="region"
  aria-roledescription="carousel"
  aria-label="{{ section.settings.region_label | escape }}"
  data-pro_agg-component="hero-slider"
  data-autoplay="{{ autoplay }}"
  data-interval="{{ autoplay_interval }}"
  data-loop="{{ loop_slides }}"
  data-swipe="{{ swipe }}"
  data-keyboard="{{ keyboard }}"
  data-reduce-motion-policy="{{ reduce_motion_policy }}"
  data-height-mode="{{ height_mode }}"
  data-fixed-height="{{ fixed_height }}"
  data-aspect-ratio="{{ aspect_ratio }}"
  style="--pro-agg-overlay-color: {{ overlay_color }}; --pro-agg-overlay-opacity: {{ overlay_opacity }}; --pro-agg-overlay-blend: {{ overlay_blend }}; --pro-agg-container-max: {{ container_max_width }}px; --pro-agg-content-max: {{ content_max_width }}px;"
>
  <div class="pro_agg_hero-slider__viewport" tabindex="-1">
    <div class="pro_agg_hero-slider__track" role="list">
      {%- assign slide_count = section.blocks.size -%}
      {%- if slide_count == 0 -%}
        <article class="pro_agg_hero-slide is-active" role="group" aria-roledescription="slide" aria-label="{{ 'general.slide' | t }} 1 {{ 'general.of' | t }} 1" aria-hidden="false" data-index="0">
          <div class="pro_agg_hero-slide__media">
            {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
          <div class="pro_agg_hero-slide__overlay" aria-hidden="true"></div>
          <div class="pro_agg_hero-slide__grid">
            <div class="pro_agg_hero-slide__content pos-mc" style="text-align:center;">
              <h2 class="pro_agg_hero-slide__heading">{{ 'homepage.onboarding.slide_title' | t }}</h2>
              <p class="pro_agg_hero-slide__subheading">{{ 'homepage.onboarding.slide_subtitle' | t }}</p>
            </div>
          </div>
        </article>
      {%- endif -%}

      {%- for block in section.blocks -%}
        {%- assign idx = forloop.index0 -%}
        {%- assign is_first = forloop.first -%}
        {%- assign active_class = is_first | default: false | if: ' is-active', '' -%}

        {%- capture desktop_pos -%}
          {%- if block.settings.content_position_desktop != 'inherit' -%}
            {{ block.settings.content_position_desktop }}
          {%- else -%}
            {{ section.settings.content_position_desktop }}
          {%- endif -%}
        {%- endcapture -%}

        {%- capture mobile_pos -%}
          {%- if block.settings.content_position_mobile != 'inherit' -%}
            {{ block.settings.content_position_mobile }}
          {%- else -%}
            {{ section.settings.content_position_mobile }}
          {%- endif -%}
        {%- endcapture -%}

        {%- assign block_overlay_color = block.settings.overlay_color | default: overlay_color -%}
        {%- assign block_overlay_opacity = block.settings.overlay_opacity | default: section.settings.overlay_opacity -%}
        {%- assign block_overlay_blend = block.settings.overlay_blend | default: overlay_blend -%}
        {%- assign block_shimmer = block.settings.enable_shimmer | default: shimmer_global -%}

        <article id="{{ section_id }}-slide-{{ idx }}"
                 class="pro_agg_hero-slide{{ active_class }}"
                 role="group"
                 aria-roledescription="slide"
                 aria-label="{{ 'general.slide' | t }} {{ forloop.index }} {{ 'general.of' | t }} {{ slide_count }}"
                 aria-hidden="{{ is_first | default: false | unless: true }}"
                 data-index="{{ idx }}"
                 {{ block.shopify_attributes }}>
          <div class="pro_agg_hero-slide__media">
            {%- assign desktop = block.settings.image -%}
            {%- assign mobile = block.settings.mobile_image -%}
            {%- if desktop or mobile -%}
              <picture>
                {%- if mobile -%}
                  {%- assign mw = '375, 550, 750, 1100' | split: ', ' -%}
                  <source media="(max-width: 749px)"
                          srcset="{% for w in mw %}{{ mobile | image_url: width: w | escape }} {{ w }}w{% unless forloop.last %}, {% endunless %}{% endfor %}"
                          sizes="100vw">
                {%- endif -%}
                {%- if desktop -%}
                  {%- assign dw = '750, 1100, 1500, 2200, 3000, 3840' | split: ', ' -%}
                  <img
                    class="pro_agg_hero-slide__image"
                    src="{{ desktop | image_url: width: 1500 }}"
                    srcset="{% for w in dw %}{{ desktop | image_url: width: w | escape }} {{ w }}w{% unless forloop.last %}, {% endunless %}{% endfor %}"
                    sizes="100vw"
                    alt="{{ block.settings.image_alt | default: block.settings.heading | escape }}"
                    loading="{{ is_first | default: false | if: 'eager', 'lazy' }}"
                    width="{{ desktop.width }}"
                    height="{{ desktop.height }}"
                    style="object-position: {{ block.settings.object_position | default: '50% 50%' }};"
                  >
                {%- else -%}
                  {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
                {%- endif -%}
              </picture>
            {%- else -%}
              {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
            {%- endif -%}
          </div>

          <div class="pro_agg_hero-slide__overlay"
               style="--pro-agg-overlay-color: {{ block_overlay_color }}; --pro-agg-overlay-opacity: {{ block_overlay_opacity | divided_by: 100.0 }}; --pro-agg-overlay-blend: {{ block_overlay_blend }};"
               aria-hidden="true"></div>

          <div class="pro_agg_hero-slide__grid">
            {%- assign text_align = block.settings.text_align | default: 'left' -%}
            <div class="pro_agg_hero-slide__content pos-{{ desktop_pos | strip }} mpos-{{ mobile_pos | strip }}"
                 style="text-align:{{ text_align }};">
              {%- if block.settings.kicker != blank -%}
                <p class="pro_agg_hero-slide__kicker">{{ block.settings.kicker | escape }}</p>
              {%- endif -%}

              {%- if block.settings.heading != blank -%}
                <h2 class="pro_agg_hero-slide__heading{% if block_shimmer %} shimmer{% endif %}"
                    style="--pro-agg-heading-size: {{ block.settings.heading_size }};">
                  {{ block.settings.heading | escape }}
                </h2>
              {%- endif -%}

              {%- if block.settings.subheading != blank -%}
                <p class="pro_agg_hero-slide__subheading"
                   style="--pro-agg-subheading-size: {{ block.settings.subheading_size }};">
                  {{ block.settings.subheading | escape }}
                </p>
              {%- endif -%}

              {%- if block.settings.richtext != blank -%}
                <div class="pro_agg_hero-slide__richtext rte">{{ block.settings.richtext }}</div>
              {%- endif -%}

              {%- assign btns = 0 -%}
              {%- if block.settings.btn_1_label != blank and block.settings.btn_1_link != blank -%}{%- assign btns = btns | plus: 1 -%}{%- endif -%}
              {%- if block.settings.btn_2_label != blank and block.settings.btn_2_link != blank -%}{%- assign btns = btns | plus: 1 -%}{%- endif -%}
              {%- if btns > 0 -%}
                <div class="pro_agg_hero-slide__buttons btn-count-{{ btns }}">
                  {%- if block.settings.btn_1_label != blank and block.settings.btn_1_link != blank -%}
                    <a class="pro_agg_btn pro_agg_btn--{{ block.settings.btn_1_style }}"
                       href="{{ block.settings.btn_1_link }}"
                       {% if block.settings.btn_1_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
                       aria-label="{{ block.settings.btn_1_label | escape }}">
                      {{ block.settings.btn_1_label | escape }}
                    </a>
                  {%- endif -%}
                  {%- if block.settings.btn_2_label != blank and block.settings.btn_2_link != blank -%}
                    <a class="pro_agg_btn pro_agg_btn--{{ block.settings.btn_2_style }}"
                       href="{{ block.settings.btn_2_link }}"
                       {% if block.settings.btn_2_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
                       aria-label="{{ block.settings.btn_2_label | escape }}">
                      {{ block.settings.btn_2_label | escape }}
                    </a>
                  {%- endif -%}
                </div>
              {%- endif -%}
            </div>
          </div>
        </article>
      {%- endfor -%}
    </div>
  </div>

  <div class="pro_agg_hero-slider__controls" aria-hidden="{{ show_arrows | unless: true }}">
    {%- if show_arrows -%}
      <button class="pro_agg_nav pro_agg_nav--prev" type="button" aria-controls="{{ section_id }}" aria-label="{{ 'general.previous' | t }}">
        <span aria-hidden="true">&larr;</span>
      </button>
      <button class="pro_agg_nav pro_agg_nav--next" type="button" aria-controls="{{ section_id }}" aria-label="{{ 'general.next' | t }}">
        <span aria-hidden="true">&rarr;</span>
      </button>
    {%- endif -%}

    <button class="pro_agg_play-pause" type="button" aria-controls="{{ section_id }}" aria-pressed="false" aria-label="{{ 'general.pause_slideshow' | t }}">
      <span class="pro_agg_sr-only">Toggle autoplay</span>
      <span class="pro_agg_play-pause__icon" aria-hidden="true">⏯</span>
    </button>
  </div>

  {%- if show_dots and section.blocks.size > 1 -%}
    <div class="pro_agg_hero-slider__dots" role="tablist" aria-label="{{ 'general.slideshow_pagination' | t }}">
      {%- for block in section.blocks -%}
        {%- assign idx = forloop.index0 -%}
        <button class="pro_agg_dot{% if forloop.first %} is-active{% endif %}"
                role="tab"
                aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
                aria-controls="{{ section_id }}-slide-{{ idx }}"
                data-index="{{ idx }}"
                aria-label="{{ 'general.go_to_slide' | t }} {{ forloop.index }}">
          <span class="pro_agg_sr-only">{{ 'general.slide' | t }} {{ forloop.index }}</span>
        </button>
      {%- endfor -%}
    </div>
  {%- endif -%}

  <p class="pro_agg_sr-only" aria-live="polite" aria-atomic="true" data-pro_agg-role="status"></p>
</section>

{% schema %}
{
  "name": "AGG • Hero slider",
  "tag": "section",
  "class": "pro_agg_hero-slider-section",
  "settings": [
    { "type": "text", "id": "region_label", "label": "Accessible label (screen readers)", "default": "Hero carousel" },

    { "type": "select", "id": "height_mode", "label": "Height mode", "default": "viewport", "options": [
      { "value": "viewport", "label": "Viewport height" },
      { "value": "fixed", "label": "Fixed height (px)" },
      { "value": "aspect", "label": "Aspect ratio" }
    ]},
    { "type": "range", "id": "fixed_height", "min": 320, "max": 900, "step": 10, "unit": "px", "label": "Fixed height", "default": 620 },
    { "type": "text", "id": "aspect_ratio", "label": "Aspect ratio (w:h)", "default": "16:9", "info": "Example: 16:9, 21:9, 4:3" },

    { "type": "range", "id": "container_max_width", "min": 960, "max": 1920, "step": 10, "unit": "px", "label": "Max width (desktop container)", "default": 1600 },
    { "type": "range", "id": "content_max_width", "min": 320, "max": 900, "step": 10, "unit": "px", "label": "Max width of text box", "default": 680 },

    { "type": "checkbox", "id": "show_arrows", "label": "Show previous/next arrows", "default": true },
    { "type": "checkbox", "id": "show_dots", "label": "Show pagination dots", "default": true },

    { "type": "checkbox", "id": "autoplay", "label": "Enable autoplay", "default": true },
    { "type": "range", "id": "autoplay_interval", "min": 3, "max": 12, "step": 1, "unit": "s", "label": "Autoplay interval", "default": 6 },
    { "type": "checkbox", "id": "loop_slides", "label": "Loop slides", "default": true },

    { "type": "checkbox", "id": "enable_swipe", "label": "Enable touch swipe", "default": true },
    { "type": "checkbox", "id": "enable_keyboard", "label": "Enable keyboard arrows", "default": true },

    { "type": "checkbox", "id": "enable_shimmer", "label": "Enable shimmer text (ambient)", "default": true },

    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "min": 0, "max": 95, "step": 1, "unit": "%", "label": "Overlay opacity", "default": 35 },
    { "type": "select", "id": "overlay_blend", "label": "Overlay blend mode", "default": "normal", "options": [
      { "value": "normal", "label": "Normal" },
      { "value": "multiply", "label": "Multiply" },
      { "value": "screen", "label": "Screen" },
      { "value": "overlay", "label": "Overlay" },
      { "value": "soft-light", "label": "Soft light" }
    ]},

    { "type": "select", "id": "reduce_motion_policy", "label": "Reduced motion policy", "default": "respect", "options": [
      { "value": "respect", "label": "Respect user setting (pause autoplay)" },
      { "value": "force_off", "label": "Disable autoplay and animations" },
      { "value": "ignore", "label": "Always animate (not recommended)" }
    ]},

    { "type": "select", "id": "content_position_desktop", "label": "Desktop content position", "default": "mc", "options": [
      { "value": "tl", "label": "Top left" }, { "value": "tc", "label": "Top center" }, { "value": "tr", "label": "Top right" },
      { "value": "ml", "label": "Middle left" }, { "value": "mc", "label": "Middle center" }, { "value": "mr", "label": "Middle right" },
      { "value": "bl", "label": "Bottom left" }, { "value": "bc", "label": "Bottom center" }, { "value": "br", "label": "Bottom right" }
    ]},
    { "type": "select", "id": "content_position_mobile", "label": "Mobile content position", "default": "bc", "options": [
      { "value": "tl", "label": "Top left" }, { "value": "tc", "label": "Top center" }, { "value": "tr", "label": "Top right" },
      { "value": "ml", "label": "Middle left" }, { "value": "mc", "label": "Middle center" }, { "value": "mr", "label": "Middle right" },
      { "value": "bl", "label": "Bottom left" }, { "value": "bc", "label": "Bottom center" }, { "value": "br", "label": "Bottom right" }
    ]}
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Desktop image" },
        { "type": "image_picker", "id": "mobile_image", "label": "Mobile image (optional)" },
        { "type": "text", "id": "image_alt", "label": "Image alt text", "info": "Describe the image content for accessibility." },
        { "type": "text", "id": "kicker", "label": "Kicker (small heading)" },
        { "type": "text", "id": "heading", "label": "Heading" },
        { "type": "text", "id": "subheading", "label": "Subheading" },
        { "type": "richtext", "id": "richtext", "label": "Body (optional)" },
        { "type": "select", "id": "text_align", "label": "Text alignment", "default": "left", "options": [
          { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
        ]},
        { "type": "select", "id": "heading_size", "label": "Heading size", "default": "clamp(28px,4vw,56px)", "options": [
          { "value": "clamp(24px,3.2vw,48px)", "label": "S" },
          { "value": "clamp(28px,4vw,56px)", "label": "M" },
          { "value": "clamp(32px,5vw,64px)", "label": "L" }
        ]},
        { "type": "select", "id": "subheading_size", "label": "Subheading size", "default": "clamp(16px,1.6vw,22px)", "options": [
          { "value": "clamp(14px,1.4vw,20px)", "label": "S" },
          { "value": "clamp(16px,1.6vw,22px)", "label": "M" },
          { "value": "clamp(18px,2vw,26px)", "label": "L" }
        ]},
        { "type": "text", "id": "object_position", "label": "Image focal point (CSS object-position)", "default": "50% 50%", "info": "e.g., 50% 30% or center right" },

        { "type": "checkbox", "id": "enable_shimmer", "label": "Shimmer heading", "default": false },

        { "type": "color", "id": "overlay_color", "label": "Overlay color (override)", "default": "" },
        { "type": "range", "id": "overlay_opacity", "min": 0, "max": 95, "step": 1, "unit": "%", "label": "Overlay opacity (override)", "default": 0 },
        { "type": "select", "id": "overlay_blend", "label": "Overlay blend (override)", "default": "inherit", "options": [
          { "value": "inherit", "label": "Inherit section" },
          { "value": "normal", "label": "Normal" },
          { "value": "multiply", "label": "Multiply" },
          { "value": "screen", "label": "Screen" },
          { "value": "overlay", "label": "Overlay" },
          { "value": "soft-light", "label": "Soft light" }
        ]},

        { "type": "select", "id": "content_position_desktop", "label": "Desktop content position (override)", "default": "inherit", "options": [
          { "value": "inherit", "label": "Inherit section" },
          { "value": "tl", "label": "Top left" }, { "value": "tc", "label": "Top center" }, { "value": "tr", "label": "Top right" },
          { "value": "ml", "label": "Middle left" }, { "value": "mc", "label": "Middle center" }, { "value": "mr", "label": "Middle right" },
          { "value": "bl", "label": "Bottom left" }, { "value": "bc", "label": "Bottom center" }, { "value": "br", "label": "Bottom right" }
        ]},
        { "type": "select", "id": "content_position_mobile", "label": "Mobile content position (override)", "default": "inherit", "options": [
          { "value": "inherit", "label": "Inherit section" },
          { "value": "tl", "label": "Top left" }, { "value": "tc", "label": "Top center" }, { "value": "tr", "label": "Top right" },
          { "value": "ml", "label": "Middle left" }, { "value": "mc", "label": "Middle center" }, { "value": "mr", "label": "Middle right" },
          { "value": "bl", "label": "Bottom left" }, { "value": "bc", "label": "Bottom center" }, { "value": "br", "label": "Bottom right" }
        ]},

        { "type": "text", "id": "btn_1_label", "label": "Primary button label" },
        { "type": "url", "id": "btn_1_link", "label": "Primary button link" },
        { "type": "checkbox", "id": "btn_1_new_tab", "label": "Open primary in new tab", "default": false },
        { "type": "select", "id": "btn_1_style", "label": "Primary button style", "default": "primary", "options": [
          { "value": "primary", "label": "Primary" },
          { "value": "secondary", "label": "Secondary" },
          { "value": "outline", "label": "Outline" },
          { "value": "ghost", "label": "Ghost" }
        ]},

        { "type": "text", "id": "btn_2_label", "label": "Secondary button label" },
        { "type": "url", "id": "btn_2_link", "label": "Secondary button link" },
        { "type": "checkbox", "id": "btn_2_new_tab", "label": "Open secondary in new tab", "default": false },
        { "type": "select", "id": "btn_2_style", "label": "Secondary button style", "default": "secondary", "options": [
          { "value": "primary", "label": "Primary" },
          { "value": "secondary", "label": "Secondary" },
          { "value": "outline", "label": "Outline" },
          { "value": "ghost", "label": "Ghost" }
        ]}
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "AGG • Hero slider",
      "category": "AGG",
      "blocks": [
        { "type": "slide", "settings": { "kicker": "Adventure awaits", "heading": "Tow. Haul. Explore.", "subheading": "Built for family road trips and weekend warriors." } },
        { "type": "slide", "settings": { "kicker": "Cargo made easy", "heading": "Secure your gear", "subheading": "Smart racks and storage systems." } }
      ]
    }
  ]
}
{% endschema %}
