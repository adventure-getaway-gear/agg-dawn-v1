{%- comment -%}
Tiny helpers: ensure lazy loading where safe, add alt fallbacks, and defer decoding for non-critical images.
{%- endcomment -%}
<script>
  (function(){
    try{
      var isReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      // Add loading=lazy to below-the-fold images missing it
      var imgs = document.querySelectorAll('img:not([loading])');
      var vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
      imgs.forEach(function(img){
        var rect = img.getBoundingClientRect();
        if(rect.top > vh*0.9){ img.setAttribute('loading','lazy'); }
        if(!img.hasAttribute('decoding')){ img.setAttribute('decoding','async'); }
        if(!img.getAttribute('alt')){
          var alt = img.getAttribute('data-alt') || img.getAttribute('title') || document.title;
          if(alt) img.setAttribute('alt', alt);
        }
      });
      // Add lazy for iframes/videos where safe
      document.querySelectorAll('iframe:not([loading])').forEach(function(f){ f.setAttribute('loading','lazy'); });
      document.querySelectorAll('video[preload="auto"]').forEach(function(v){ if(isReduced){ v.removeAttribute('autoplay'); } v.setAttribute('preload','metadata'); });
    }catch(e){}
  })();
</script>
